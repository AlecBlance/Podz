import { Link, useMatch } from "react-router-dom";
import RecentMusic from "../Music/RecentMusic";
import { useAppSelector } from "../../hooks";
import { useEffect, useRef, useState } from "react";

const Sidebar = () => {
  const isHome = useMatch("/");
  const isLibrary = useMatch("/library");
  const isSearch = useMatch("/search");
  const recent = useAppSelector((state) => state.recent);

  const sectionRef = useRef<HTMLDivElement>(null);
  const section = sectionRef.current;
  const [limit, setLimit] = useState<number>(20);

  const getLimit = (height: number) => {
    const shouldBeLimit = Math.floor(height / 60);
    return height % 60 ? shouldBeLimit - 1 : shouldBeLimit;
  };

  useEffect(() => {
    if (!section) return;
    setLimit(getLimit(section.offsetHeight));
    window.addEventListener("resize", () => {
      setLimit(getLimit(section.offsetHeight));
    });
  }, [section]);

  return (
    <div className="bg-[#252525] w-1/4 flex flex-col">
      <div className="flex justify-center my-5 items-center">
        <svg
          width="40"
          height="36"
          viewBox="0 0 40 36"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
          className="w-7 h-7"
        >
          <path
            fillRule="evenodd"
            clipRule="evenodd"
            d="M25 30.5C26.3132 30.5 27.6136 30.2413 28.8268 29.7388C30.0401 29.2362 31.1425 28.4997 32.0711 27.5711C32.9997 26.6425 33.7362 25.5401 34.2388 24.3268C34.7413 23.1136 35 21.8132 35 20.5C35 16.5218 33.4196 12.7064 30.6066 9.8934C27.7936 7.08035 23.9782 5.5 20 5.5C16.0218 5.5 12.2064 7.08035 9.3934 9.8934C6.58035 12.7064 5 16.5218 5 20.5C5 21.8132 5.25866 23.1136 5.7612 24.3268C6.26375 25.5401 7.00035 26.6425 7.92893 27.5711C8.85752 28.4997 9.95991 29.2362 11.1732 29.7388C12.3864 30.2413 13.6868 30.5 15 30.5H25ZM20 9.5C17.0826 9.5 14.2847 10.6589 12.2218 12.7218C10.1589 14.7847 9 17.5826 9 20.5C9 21.2879 9.15519 22.0681 9.45672 22.7961C9.75825 23.5241 10.2002 24.1855 10.7574 24.7426C11.3145 25.2998 11.9759 25.7417 12.7039 26.0433C13.4319 26.3448 14.2121 26.5 15 26.5H25C25.7879 26.5 26.5681 26.3448 27.2961 26.0433C28.0241 25.7417 28.6855 25.2998 29.2426 24.7426C29.7998 24.1855 30.2417 23.5241 30.5433 22.7961C30.8448 22.0681 31 21.2879 31 20.5C31 17.5826 29.8411 14.7847 27.7782 12.7218C25.7153 10.6589 22.9174 9.5 20 9.5Z"
            fill="#1B6AE3"
          />
          <path
            fillRule="evenodd"
            clipRule="evenodd"
            d="M13 35.5C11.2928 35.5 9.60238 35.112 8.02512 34.3582C6.44792 33.6044 5.0148 32.4995 3.80761 31.1066C2.60047 29.7137 1.64289 28.0602 0.989566 26.2403C0.336257 24.4204 0 22.4698 0 20.5C0 15.1957 2.10714 10.1086 5.85787 6.35786C9.60859 2.60714 14.6957 0.5 20 0.5C25.3043 0.5 30.3914 2.60714 34.1421 6.35786C37.8929 10.1086 40 15.1957 40 20.5C40 22.4698 39.6637 24.4204 39.0104 26.2403C38.3571 28.0602 37.3995 29.7137 36.1924 31.1066C34.9852 32.4995 33.5521 33.6044 31.9749 34.3582C30.3976 35.112 28.7072 35.5 27 35.5H13ZM8.68629 9.18629C11.6869 6.18571 15.7565 4.5 20 4.5C24.2435 4.5 28.3131 6.18571 31.3137 9.18629C34.3143 12.1869 36 16.2565 36 20.5C36 22.0179 35.7404 23.5107 35.2457 24.8888C34.751 26.2668 34.0376 27.4854 33.1696 28.4869C32.3026 29.4873 31.3045 30.2452 30.25 30.7492C29.1981 31.252 28.0957 31.5 27 31.5H13C11.9043 31.5 10.8019 31.252 9.74999 30.7492C8.69549 30.2452 7.6974 29.4873 6.83037 28.4869C5.96242 27.4854 5.24903 26.2668 4.75433 24.8888C4.25961 23.5107 4 22.0179 4 20.5C4 16.2565 5.68571 12.1869 8.68629 9.18629Z"
            fill="#1B6AE3"
          />
          <path
            d="M25 25.5H19.9956C19.6596 25.4997 19.3261 25.4655 19 25.399C18.368 25.27 17.7637 25.0192 17.2222 24.6573C16.3999 24.1079 15.759 23.3271 15.3806 22.4134C15.2579 22.1171 15.1645 21.8112 15.101 21.5C14.9686 20.8515 14.9657 20.1799 15.0961 19.5245C15.289 18.5546 15.7652 17.6637 16.4645 16.9645C17.1637 16.2652 18.0546 15.789 19.0245 15.5961C19.0549 15.59 19.0852 15.5843 19.1156 15.5788C19.4087 15.5262 19.7047 15.5 20 15.5C20.6535 15.5 21.3038 15.6281 21.9134 15.8806C22.827 16.259 23.6079 16.8999 24.1573 17.7221C24.7068 18.5444 25 19.5111 25 20.5H21C21 20.3022 20.9414 20.1089 20.8315 19.9444C20.7216 19.78 20.5654 19.6518 20.3827 19.5761C20.2 19.5004 19.9989 19.4806 19.8049 19.5192C19.6109 19.5578 19.4327 19.653 19.2929 19.7929C19.153 19.9327 19.0578 20.1109 19.0192 20.3049C18.9806 20.4989 19.0004 20.7 19.0761 20.8827C19.1518 21.0654 19.28 21.2216 19.4444 21.3315C19.6089 21.4414 19.8022 21.5 20 21.5H25C25.1313 21.5 25.2614 21.4741 25.3827 21.4239C25.504 21.3736 25.6142 21.3 25.7071 21.2071C25.8 21.1142 25.8736 21.004 25.9239 20.8827C25.9741 20.7614 26 20.6313 26 20.5C26 18.9087 25.3679 17.3826 24.2426 16.2574C23.1174 15.1321 21.5913 14.5 20 14.5C19.8274 14.5 19.6556 14.5074 19.485 14.5221C19.0657 14.5582 18.6535 14.6382 18.255 14.7594C17.8629 14.8785 17.484 15.0376 17.1243 15.234C16.7123 15.459 16.3255 15.733 15.973 16.0522C15.8996 16.1186 15.8277 16.187 15.7574 16.2574C15.2651 16.7496 14.8672 17.3187 14.5753 17.9363C14.4294 18.2451 14.3099 18.566 14.2185 18.8956C14.1139 19.2724 14.0459 19.6604 14.0166 20.0544C14.0056 20.2022 14 20.3508 14 20.5C14 21.2841 14.1537 22.0646 14.4567 22.7961C14.9109 23.8925 15.6799 24.8295 16.6666 25.4888C16.6722 25.4926 16.6778 25.4963 16.6834 25.5H15C14.3434 25.5 13.6932 25.3707 13.0866 25.1194C12.48 24.8681 11.9288 24.4998 11.4645 24.0355C11.0002 23.5712 10.6319 23.02 10.3806 22.4134C10.1293 21.8068 10 21.1566 10 20.5C10 17.8478 11.0536 15.3043 12.9289 13.4289C14.8043 11.5536 17.3478 10.5 20 10.5C22.6522 10.5 25.1957 11.5536 27.0711 13.4289C28.9464 15.3043 30 17.8478 30 20.5C30 21.1566 29.8707 21.8068 29.6194 22.4134C29.3681 23.02 28.9998 23.5712 28.5355 24.0355C28.0712 24.4998 27.52 24.8681 26.9134 25.1194C26.3068 25.3707 25.6566 25.5 25 25.5Z"
            fill="#1B6AE3"
          />
        </svg>
        <h1 className="text-custom-neutrals-offwhite font-bold text-xl ml-1">
          Podz
        </h1>
      </div>
      <div className="border-b border-slate-200/30 p-3 pt-0">
        <Link
          to="/"
          className={`flex mb-4 items-center group text-sm hover:text-custom-vibrant-blue font-bold ${
            isHome ? "text-custom-vibrant-blue" : "text-custom-card-artist"
          }`}
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            strokeWidth={1.5}
            stroke="currentColor"
            className={`w-5 h-5 mr-4 group-hover:text-custom-vibrant-blue ${
              isHome ? "text-custom-vibrant-blue" : "text-custom-card-artist"
            }`}
          >
            <path
              strokeLinecap="round"
              strokeLinejoin="round"
              d="M2.25 12l8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25"
            />
          </svg>
          Home
        </Link>
        <Link
          to="/library"
          className={`flex mb-4 items-center group text-sm hover:text-custom-vibrant-blue font-bold ${
            isLibrary ? "text-custom-vibrant-blue" : "text-custom-card-artist"
          }`}
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            strokeWidth={1.5}
            stroke="currentColor"
            className={`w-5 h-5 mr-4 group-hover:text-custom-vibrant-blue ${
              isLibrary ? "text-custom-vibrant-blue" : "text-custom-card-artist"
            }`}
          >
            <path
              strokeLinecap="round"
              strokeLinejoin="round"
              d="M9 4.5v15m6-15v15m-10.875 0h15.75c.621 0 1.125-.504 1.125-1.125V5.625c0-.621-.504-1.125-1.125-1.125H4.125C3.504 4.5 3 5.004 3 5.625v12.75c0 .621.504 1.125 1.125 1.125z"
            />
          </svg>
          Library
        </Link>
        <Link
          to="/search"
          className={`flex items-center group text-sm hover:text-custom-vibrant-blue font-bold ${
            isSearch ? "text-custom-vibrant-blue" : "text-custom-card-artist"
          }`}
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            strokeWidth={1.5}
            stroke="currentColor"
            className={`w-5 h-5 mr-4 group-hover:text-custom-vibrant-blue ${
              isSearch ? "text-custom-vibrant-blue" : "text-custom-card-artist"
            }`}
          >
            <path
              strokeLinecap="round"
              strokeLinejoin="round"
              d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"
            />
          </svg>
          Search
        </Link>
      </div>
      <div className="grow flex flex-col overflow-hidden font-medium text-custom-neutrals-offwhite">
        <div className="flex m-3 mb-4">
          <svg
            width="24"
            height="25"
            viewBox="0 0 24 25"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
            className="mr-4 w-5 h-5 text-custom-neutrals-offwhite"
          >
            <path
              d="M17.68 7.72006V9.12006C17.68 9.80006 17.13 10.3601 16.43 10.3601C15.74 10.3601 15.18 9.80006 15.18 9.12006V7.72006C15.18 7.38854 15.3117 7.0706 15.5461 6.83618C15.7805 6.60176 16.0985 6.47006 16.43 6.47006C17.13 6.47006 17.68 7.03006 17.68 7.72006ZM13.25 8.86006V16.1301C13.25 16.4616 13.1183 16.7795 12.8839 17.0139C12.6495 17.2484 12.3315 17.3801 12 17.3801C11.6685 17.3801 11.3505 17.2484 11.1161 17.0139C10.8817 16.7795 10.75 16.4616 10.75 16.1301V8.86006C10.75 8.18006 11.31 7.61006 12 7.61006C12.69 7.61006 13.25 8.18006 13.25 8.86006ZM22 11.8001V13.2001C22 13.8801 21.44 14.4401 20.75 14.4401C20.06 14.4401 19.5 13.8801 19.5 13.2001V11.8001C19.5 11.1101 20.06 10.5601 20.75 10.5601C21.44 10.5601 22 11.1101 22 11.8001ZM4.5 11.8001V13.2001C4.5 13.8801 3.94 14.4401 3.25 14.4401C2.55 14.4401 2 13.8801 2 13.2001V11.8001C2 11.1101 2.55 10.5601 3.25 10.5601C3.94 10.5601 4.5 11.1101 4.5 11.8001ZM8.82 15.8801V17.2701C8.82 17.9501 8.26 18.5001 7.57 18.5001C6.88 18.5001 6.32 17.9501 6.32 17.2701V15.8801C6.32 15.1801 6.88 14.6301 7.57 14.6301C7.90152 14.6301 8.21946 14.7618 8.45388 14.9962C8.6883 15.2306 8.82 15.5485 8.82 15.8801ZM13.25 19.8601V21.2501C13.25 21.5816 13.1183 21.8995 12.8839 22.1339C12.6495 22.3684 12.3315 22.5001 12 22.5001C11.6685 22.5001 11.3505 22.3684 11.1161 22.1339C10.8817 21.8995 10.75 21.5816 10.75 21.2501V19.8601C10.75 19.5285 10.8817 19.2106 11.1161 18.9762C11.3505 18.7418 11.6685 18.6101 12 18.6101C12.3315 18.6101 12.6495 18.7418 12.8839 18.9762C13.1183 19.2106 13.25 19.5285 13.25 19.8601ZM13.25 3.75006V5.14006C13.25 5.47158 13.1183 5.78952 12.8839 6.02394C12.6495 6.25836 12.3315 6.39006 12 6.39006C11.6685 6.39006 11.3505 6.25836 11.1161 6.02394C10.8817 5.78952 10.75 5.47158 10.75 5.14006V3.75006C10.75 3.05006 11.31 2.50006 12 2.50006C12.3315 2.50006 12.6495 2.63176 12.8839 2.86618C13.1183 3.1006 13.25 3.41854 13.25 3.75006ZM17.68 12.8401V17.2701C17.68 17.9601 17.13 18.5001 16.43 18.5001C15.74 18.5001 15.18 17.9601 15.18 17.2701V12.8401C15.18 12.1401 15.74 11.5901 16.43 11.5901C17.13 11.5901 17.68 12.1401 17.68 12.8401ZM8.82 7.72006V12.1501C8.82 12.8501 8.26 13.4001 7.57 13.4001C7.40585 13.4001 7.2433 13.3677 7.09165 13.3049C6.93999 13.2421 6.80219 13.15 6.68612 13.0339C6.57004 12.9179 6.47797 12.7801 6.41515 12.6284C6.35233 12.4768 6.32 12.3142 6.32 12.1501V7.72006C6.32 7.38854 6.4517 7.0706 6.68612 6.83618C6.92054 6.60176 7.23848 6.47006 7.57 6.47006C7.90152 6.47006 8.21946 6.60176 8.45388 6.83618C8.6883 7.0706 8.82 7.38854 8.82 7.72006Z"
              fill="#FFF9EF"
            />
          </svg>
          <p className="text-sm">Your Recent Podz</p>
        </div>
        <div className="h-full" ref={sectionRef}>
          {recent
            .slice()
            .reverse()
            .slice(0, limit)
            .map((played) => (
              <RecentMusic
                key={`${played.id}-${Math.random()}`}
                played={played}
              />
            ))}
        </div>
      </div>
    </div>
  );
};
export default Sidebar;
